<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Invitaci√≥n Mis 15 A√±os - Panel de Control</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&family=Montserrat:wght@300;400;500&family=Satisfy&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Montserrat', sans-serif;
    }
    .font-dancing-script {
      font-family: 'Dancing Script', cursive;
    }
    .font-satisfy {
      font-family: 'Satisfy', cursive;
    }
    
    /* Animations & Custom Styles */
    @keyframes fade-in {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    .animate-fade-in {
      animation: fade-in 0.3s ease-out forwards;
    }
    
    @keyframes scale-up {
      from { transform: scale(0.95); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }
    .animate-scale-up {
      animation: scale-up 0.3s ease-out forwards;
    }

    @keyframes fade-in-item {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }
    .animate-fade-in-item {
      animation: fade-in-item 0.4s ease-out forwards;
    }
    
    .custom-scrollbar::-webkit-scrollbar {
      width: 8px;
    }
    .custom-scrollbar::-webkit-scrollbar-track {
      background: transparent;
    }
    .custom-scrollbar::-webkit-scrollbar-thumb {
      background-color: rgba(221, 160, 172, 0.5);
      border-radius: 20px;
      border: 3px solid transparent;
    }
  </style>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.1.0",
    "react-dom/client": "https://esm.sh/react-dom@^19.1.0/client",
    "@google/genai": "https://esm.sh/@google/genai@^1.9.0",
    "@supabase/supabase-js": "https://esm.sh/@supabase/supabase-js@2",
    "react-dom/": "https://esm.sh/react-dom@^19.1.0/",
    "react/": "https://esm.sh/react@^19.1.0/",
    "jspdf": "https://esm.sh/jspdf@2.5.1",
    "jspdf-autotable": "https://esm.sh/jspdf-autotable@3.8.2"
  }
}
</script>
</head>
<body>
  <div id="root"></div>

  <script type="module">
    import React from 'react';
    import ReactDOM from 'react-dom/client';
    import { GoogleGenAI } from "@google/genai";
    import { createClient } from '@supabase/supabase-js';
    import jsPDF from 'jspdf';
    import autoTable from 'jspdf-autotable';

    // --- From constants.ts ---
    const QUINCEANERA_NAME = "Sof√≠a";
    const PARTY_DATE_OBJ = new Date("2025-10-26T21:00:00");
    const PARTY_DATE = "S√°bado, 26 de Octubre de 2025";
    const PARTY_TIME = "21:00 Hs.";
    const PARTY_LOCATION_NAME = "Sal√≥n de Fiestas 'El Encanto'";
    const PARTY_ADDRESS = "Avenida Siempreviva 742, Springfield";
    const MAPS_URL = "https://maps.google.com/";

    // --- From services/supabaseClient.ts ---
    const supabaseUrl = 'https://rrrlmouxytovvhyxcqdy.supabase.co';
    const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJycmxtb3V4eXRvdnZoeXhjcWR5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI2NDIxMDUsImV4cCI6MjA2ODIxODEwNX0.rLrtjX_XZbYNx0HvY3CEGUULWauQt4SoWruyHpR-GE4';
    const supabase = createClient(supabaseUrl, supabaseAnonKey);

    // --- From services/geminiService.ts ---
    // Safely initialize Gemini API for browser environment
    const API_KEY = (typeof process !== 'undefined' && process.env.API_KEY) ? process.env.API_KEY : null;
    let ai = null;
    
    if (API_KEY) {
      try {
        ai = new GoogleGenAI({ apiKey: API_KEY });
      } catch (e) {
        console.error("Failed to initialize GoogleGenAI:", e);
      }
    } else {
      console.warn("Gemini API Key not found. AI features will use a fallback response.");
    }

    const getSongResponse = async (songName, guestName) => {
      if (!ai) {
        return "¬°Gracias por tu recomendaci√≥n! La agregar√© a mi playlist. üé∂";
      }
      try {
        const prompt = `Un invitado llamado "${guestName}" recomend√≥ la canci√≥n "${songName}" para una fiesta de 15 a√±os. Escribe un mensaje de agradecimiento corto, divertido y entusiasta para ${guestName}. Debe ser en espa√±ol, sonar como una quincea√±era feliz y tener menos de 20 palabras. Incluye un emoji musical.`;
        const response = await ai.models.generateContent({
          model: "gemini-2.5-flash",
          contents: prompt,
          config: { thinkingConfig: { thinkingBudget: 0 } }
        });
        return response.text;
      } catch (error) {
        console.error("Error calling Gemini API:", error);
        return "¬°Gracias por tu s√∫per recomendaci√≥n! ¬°Me encanta! üíñ";
      }
    };

    // --- From utils/songUtils.ts ---
    const toTitleCase = (str) => {
      if (!str) return str;
      return str
        .toLowerCase()
        .split(' ')
        .map(word => word.charAt(0).toUpperCase() + word.slice(1))
        .join(' ');
    };
    const normalizeSongKey = (songName) => {
      if (!songName) return '';
      return songName
        .toLowerCase()
        .normalize("NFD")
        .replace(/[\u0300-\u036f]/g, "")
        .replace(/[^a-z0-9]/g, '');
    };
    const levenshteinDistance = (a, b) => {
      if (a.length === 0) return b.length;
      if (b.length === 0) return a.length;
      const matrix = Array(b.length + 1).fill(null).map(() => Array(a.length + 1).fill(null));
      for (let i = 0; i <= a.length; i++) matrix[0][i] = i;
      for (let j = 0; j <= b.length; j++) matrix[j][0] = j;
      for (let j = 1; j <= b.length; j++) {
        for (let i = 1; i <= a.length; i++) {
          const cost = a[i - 1] === b[j - 1] ? 0 : 1;
          matrix[j][i] = Math.min(matrix[j][i - 1] + 1, matrix[j - 1][i] + 1, matrix[j - 1][i - 1] + cost);
        }
      }
      return matrix[b.length][a.length];
    };
    const processRecommendations = (data) => {
      const fuzzyGroups = [];
      data.forEach(rec => {
        if (!rec.song_name || !rec.guest_name) return;
        const currentSongKey = normalizeSongKey(rec.song_name);
        if (!currentSongKey) return;
        const capitalizedGuestName = toTitleCase(rec.guest_name.trim());
        const originalName = toTitleCase(rec.song_name.trim());
        let foundGroup = false;
        for (const group of fuzzyGroups) {
          const distance = levenshteinDistance(currentSongKey, group.key);
          if (distance / Math.max(currentSongKey.length, group.key.length) < 0.20) {
            group.originalNames.push(originalName);
            group.guests.add(capitalizedGuestName);
            if (currentSongKey.length > group.key.length) {
              group.key = currentSongKey;
            }
            foundGroup = true;
            break;
          }
        }
        if (!foundGroup) {
          fuzzyGroups.push({ key: currentSongKey, originalNames: [originalName], guests: new Set([capitalizedGuestName]) });
        }
      });
      const processedList = fuzzyGroups.map(group => {
        const nameCounts = new Map();
        group.originalNames.forEach(name => nameCounts.set(name, (nameCounts.get(name) || 0) + 1));
        let canonicalName = group.originalNames[0] || 'Canci√≥n Desconocida';
        let maxCount = 0;
        nameCounts.forEach((count, name) => {
          if (count > maxCount) {
            maxCount = count;
            canonicalName = name;
          } else if (count === maxCount && name.length > canonicalName.length) {
            canonicalName = name;
          }
        });
        const sortedGuests = Array.from(group.guests).sort();
        return { key: group.key, song_name: canonicalName, count: sortedGuests.length, guests: sortedGuests };
      });
      return processedList.sort((a, b) => b.count - a.count);
    };
    
    // --- From contexts/AuthContext.tsx ---
    const { createContext, useState, useContext, useEffect, useCallback } = React;
    const ADMIN_USERS = { 'nicki': '202515a√±os', 'keila': '202515a√±os' };
    const AuthContext = createContext(null);
    const AuthProvider = ({ children }) => {
      const [user, setUser] = useState(() => {
        try {
          const storedUser = sessionStorage.getItem('quinces_user_auth');
          return storedUser ? JSON.parse(storedUser) : null;
        } catch (e) {
          return null;
        }
      });

      const login = useCallback((username, pass) => {
        const lowercasedUser = username.toLowerCase().trim();
        if (ADMIN_USERS.hasOwnProperty(lowercasedUser) && ADMIN_USERS[lowercasedUser] === pass) {
          const capitalizedUser = lowercasedUser.charAt(0).toUpperCase() + lowercasedUser.slice(1);
          const userObj = { name: capitalizedUser, role: 'admin' };
          sessionStorage.setItem('quinces_user_auth', JSON.stringify(userObj));
          setUser(userObj);
          return true;
        }
        return false;
      }, []);

      const loginAsTester = useCallback(async (code) => {
          const { data, error } = await supabase.from('testers').select('tester_code').eq('tester_code', code).single();
          if (error || !data) {
              console.error("Tester login error:", error);
              return false;
          }
          const userObj = { name: `Tester #${code}`, role: 'tester' };
          sessionStorage.setItem('quinces_user_auth', JSON.stringify(userObj));
          setUser(userObj);
          return true;
      }, []);

      const logout = useCallback(() => {
        sessionStorage.removeItem('quinces_user_auth');
        setUser(null);
      }, []);

      const isAuthenticated = !!user;
      
      return (
        React.createElement(AuthContext.Provider, { value: { isAuthenticated, user, login, logout, loginAsTester } }, children)
      );
    };
    const useAuth = () => {
      const context = useContext(AuthContext);
      if (!context) {
        throw new Error('useAuth must be used within an AuthProvider');
      }
      return context;
    };
    
    // --- From components/GuestConfirmation.tsx ---
    const GuestConfirmation = () => {
        const { user } = useAuth();
        const [firstName, setFirstName] = useState('');
        const [lastName, setLastName] = useState('');
        const [dni, setDni] = useState('');
        const [isLoading, setIsLoading] = useState(false);
        const [error, setError] = useState(null);
        const [successMessage, setSuccessMessage] = useState('');
        
        const [isGenerating, setIsGenerating] = useState(false);
        const [generateError, setGenerateError] = useState(null);
        const [generateSuccessMessage, setGenerateSuccessMessage] = useState('');

        const handleSubmit = useCallback(async (event) => {
            event.preventDefault();
            if (!firstName.trim() || !lastName.trim() || !dni.trim()) {
                setError("Por favor, completa todos los campos.");
                return;
            }
            setIsLoading(true);
            setError(null);
            setSuccessMessage('');
            try {
                const { error: insertError } = await supabase
                    .from('confirmed_guests')
                    .insert([{ 
                        first_name: firstName.trim(), 
                        last_name: lastName.trim(), 
                        dni: dni.trim() 
                    }]);
                if (insertError) {
                    if (insertError.code === '23505') { 
                         setError("Este DNI ya ha sido registrado. ¬°Gracias!");
                    } else {
                         setError("Hubo un error al guardar tus datos. Int√©ntalo de nuevo.");
                    }
                } else {
                    setFirstName('');
                    setLastName('');
                    setDni('');
                    setSuccessMessage("¬°Invitado guardado con √©xito!");
                    setTimeout(() => setSuccessMessage(''), 3000);
                }
            } catch (err) {
                setError("Ocurri√≥ un error inesperado. Por favor, intenta m√°s tarde.");
            } finally {
                setIsLoading(false);
            }
        }, [firstName, lastName, dni]);

        const handleGenerateGuests = useCallback(async () => {
            setIsGenerating(true);
            setGenerateError(null);
            setGenerateSuccessMessage('');
            setError(null);
            setSuccessMessage('');

            try {
                const { data: existingGuests, error: fetchError } = await supabase
                    .from('confirmed_guests')
                    .select('dni');

                if (fetchError) {
                    throw new Error(`Error al consultar invitados existentes: ${fetchError.message}`);
                }

                const existingDnis = new Set(existingGuests.map(g => g.dni));

                const allDemoGuests = [
                    { first_name: 'Luc√≠a Emilia', last_name: 'Torres', dni: '01' },
                    { first_name: 'Mateo Juli√°n', last_name: 'Herrera', dni: '02' },
                    { first_name: 'Valentina Soledad', last_name: 'Castro', dni: '03' },
                    { first_name: 'Bruno Alejandro', last_name: 'Medina', dni: '04' },
                    { first_name: 'Agustina Pilar', last_name: 'Cabrera', dni: '05' },
                    { first_name: 'Tom√°s Ezequiel', last_name: 'Paredes', dni: '06' },
                    { first_name: 'Florencia Abril', last_name: 'Sosa', dni: '07' },
                    { first_name: 'Lautaro Benjam√≠n', last_name: '√Ålvarez', dni: '08' },
                    { first_name: 'Milagros Antonella', last_name: 'Navarro', dni: '09' },
                    { first_name: 'Facundo El√≠as', last_name: 'Romero', dni: '00' }
                ];

                const guestsToCreate = allDemoGuests.filter(guest => !existingDnis.has(guest.dni));

                if (guestsToCreate.length === 0) {
                    setGenerateSuccessMessage('Todos los invitados de demostraci√≥n ya existen.');
                    setTimeout(() => setGenerateSuccessMessage(''), 5000);
                    setIsGenerating(false);
                    return;
                }
                
                const dniToNameMap = allDemoGuests.reduce((acc, guest) => {
                    acc[guest.dni] = `${guest.first_name} ${guest.last_name}`;
                    return acc;
                }, {});

                const allDemoSongs = [
                    { guest_name: dniToNameMap['01'], song_name: 'Ese Camino De Julieta Venegas' },
                    { guest_name: dniToNameMap['03'], song_name: 'Ese Camino De Julieta Venegas' },
                    { guest_name: dniToNameMap['02'], song_name: 'Have You Ever Seen The Rain De Creedance' },
                    { guest_name: dniToNameMap['00'], song_name: 'The Climb De Miley Cyrus' },
                    { guest_name: dniToNameMap['04'], song_name: 'The Climb De Miley Cyrus' },
                    { guest_name: dniToNameMap['05'], song_name: 'Valiente De Soy Luna' }
                ];
                
                const dnisToCreate = new Set(guestsToCreate.map(g => g.dni));
                const songsToCreate = allDemoSongs.filter(song => {
                     const entry = Object.entries(dniToNameMap).find(([_, name]) => name === song.guest_name);
                     return entry ? dnisToCreate.has(entry[0]) : false;
                });

                const { error: guestInsertError } = await supabase.from('confirmed_guests').insert(guestsToCreate);
                if (guestInsertError) throw new Error(`Error al insertar nuevos invitados: ${guestInsertError.message}`);
                
                const shuffledNewDnis = guestsToCreate.map(g => g.dni).sort(() => 0.5 - Math.random());
                const dnisToConfirm = shuffledNewDnis.slice(0, 7);
                
                if (dnisToConfirm.length > 0) {
                    const { error: confirmError } = await supabase
                        .from('confirmed_guests')
                        .update({ has_confirmed: true })
                        .in('dni', dnisToConfirm);
                    if (confirmError) throw new Error(`Error al confirmar invitados: ${confirmError.message}`);
                }

                if (songsToCreate.length > 0) {
                    const { error: songInsertError } = await supabase.from('song_recommendations').insert(songsToCreate);
                    if (songInsertError) throw new Error(`Error al insertar canciones: ${songInsertError.message}`);
                }

                setGenerateSuccessMessage(`¬°Se a√±adieron ${guestsToCreate.length} invitados! Los existentes no se modificaron.`);
                window.dispatchEvent(new Event('data-reset'));
                setTimeout(() => setGenerateSuccessMessage(''), 5000);

            } catch (err) {
                console.error("Error generating demo data:", err);
                setGenerateError(err.message);
            } finally {
                setIsGenerating(false);
            }
        }, []);
        
        const CheckIcon = ({ className }) => React.createElement("svg", { xmlns: "http://www.w3.org/2000/svg", className, fill: "none", viewBox: "0 0 24 24", stroke: "currentColor", strokeWidth: 2 }, React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" }));
        const SparklesIcon = ({ className }) => React.createElement("svg", { xmlns: "http://www.w3.org/2000/svg", className, fill: "none", viewBox: "0 0 24 24", stroke: "currentColor", strokeWidth: 1.5 }, React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.562L16.5 21.75l-.398-1.188a2.25 2.25 0 00-1.423-1.423L13.5 18.75l1.188-.398a2.25 2.25 0 001.423-1.423L16.5 15.75l.398 1.188a2.25 2.25 0 001.423 1.423l1.188.398-1.188.398a2.25 2.25 0 00-1.423 1.423z" }));

        return React.createElement("section", { className: "bg-white/60 p-6 rounded-xl shadow-lg text-center" },
            React.createElement("h3", { className: "font-dancing-script text-4xl text-rose-400 mb-2" }, "A√±adir Invitado"),
            React.createElement(React.Fragment, null,
                React.createElement("p", { className: "mb-6 font-light" }, "Usa este formulario para a√±adir invitados a la lista."),
                React.createElement("form", { onSubmit: handleSubmit, className: "flex flex-col gap-4 items-center justify-center w-full max-w-sm mx-auto" },
                    React.createElement("input", { type: "text", value: firstName, onChange: (e) => { setFirstName(e.target.value); if(error) setError(null); }, placeholder: "Nombre/s", className: "w-full px-4 py-3 rounded-full border border-rose-200 focus:outline-none focus:ring-2 focus:ring-rose-300 transition", disabled: isLoading || isGenerating, "aria-label": "Nombre/s" }),
                    React.createElement("input", { type: "text", value: lastName, onChange: (e) => { setLastName(e.target.value); if(error) setError(null); }, placeholder: "Apellido/s", className: "w-full px-4 py-3 rounded-full border border-rose-200 focus:outline-none focus:ring-2 focus:ring-rose-300 transition", disabled: isLoading || isGenerating, "aria-label": "Apellido/s" }),
                    React.createElement("input", { type: "text", value: dni, onChange: (e) => { setDni(e.target.value.replace(/[^0-9]/g, '')); if(error) setError(null); }, placeholder: "DNI (sin puntos)", className: "w-full px-4 py-3 rounded-full border border-rose-200 focus:outline-none focus:ring-2 focus:ring-rose-300 transition", disabled: isLoading || isGenerating, "aria-label": "DNI", inputMode: "numeric", pattern: "[0-9]*" }),
                    React.createElement("button", { type: "submit", className: "w-full bg-rose-400 text-white font-medium px-8 py-3 rounded-full shadow-md hover:bg-rose-500 transition-colors duration-300 disabled:bg-rose-300 disabled:cursor-not-allowed flex items-center justify-center", disabled: isLoading || isGenerating },
                        isLoading ? React.createElement(React.Fragment, null, React.createElement("svg", { className: "animate-spin -ml-1 mr-3 h-5 w-5 text-white", xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24" }, React.createElement("circle", { className: "opacity-25", cx: "12", cy: "12", r: "10", stroke: "currentColor", strokeWidth: "4" }), React.createElement("path", { className: "opacity-75", fill: "currentColor", d: "M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" })), "Guardando...") : React.createElement("span", {className: "flex items-center"}, React.createElement(CheckIcon, {className: "h-6 w-6 mr-2"}), "Guardar invitado")
                    )
                )
            ),
            error && React.createElement("p", { className: "text-red-500 mt-4" }, error),
            successMessage && React.createElement("p", { className: "text-green-600 mt-4 animate-fade-in" }, successMessage),
            
            user.role === 'admin' && React.createElement("div", {className: "mt-6 pt-6 border-t border-rose-200/80"},
                React.createElement("button", { 
                    type: "button", 
                    onClick: handleGenerateGuests,
                    className: "w-full bg-amber-500 text-white font-medium px-8 py-3 rounded-full shadow-md hover:bg-amber-600 transition-colors duration-300 disabled:bg-amber-300 disabled:cursor-not-allowed flex items-center justify-center", 
                    disabled: isGenerating || isLoading 
                },
                    isGenerating ? React.createElement(React.Fragment, null, React.createElement("svg", { className: "animate-spin -ml-1 mr-3 h-5 w-5 text-white", xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24" }, React.createElement("circle", { className: "opacity-25", cx: "12", cy: "12", r: "10", stroke: "currentColor", strokeWidth: "4" }), React.createElement("path", { className: "opacity-75", fill: "currentColor", d: "M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" })), "Generando...") : React.createElement("span", {className: "flex items-center justify-center"}, React.createElement(SparklesIcon, {className: "h-5 w-5 mr-2"}), "Generar Invitados")
                ),
                generateError && React.createElement("p", { className: "text-red-500 mt-4" }, generateError),
                generateSuccessMessage && React.createElement("p", { className: "text-green-600 mt-4 animate-fade-in" }, generateSuccessMessage)
            )
        );
    };

    // --- From components/ConfirmedGuestsList.tsx ---
    const ConfirmedGuestsList = () => {
        const [guests, setGuests] = useState([]);
        const [loading, setLoading] = useState(true);
        const [error, setError] = useState(null);

        const fetchGuests = useCallback(async () => {
            const { data, error } = await supabase.from('confirmed_guests').select('id, first_name, last_name, has_confirmed').order('created_at', { ascending: true });
            if (error) {
                setError("No se pudo cargar la lista. Revisa los permisos de la base de datos.");
                setLoading(false);
            } else if (data) {
                setGuests(data);
                setLoading(false);
            }
        }, []);

        useEffect(() => {
            setLoading(true);
            fetchGuests();
            
            const channel = supabase.channel('confirmed_guests_realtime')
                .on('postgres_changes', 
                    { event: '*', schema: 'public', table: 'confirmed_guests' }, 
                    (payload) => {
                        fetchGuests(); // Refetch on any change
                    }
                )
                .subscribe();
            
            // Listen for the global data reset event
            const handleDataReset = () => fetchGuests();
            window.addEventListener('data-reset', handleDataReset);

            return () => { 
                supabase.removeChannel(channel); 
                window.removeEventListener('data-reset', handleDataReset);
            };
        }, [fetchGuests]);

        const ListIcon = ({ className }) => React.createElement("svg", { xmlns: "http://www.w3.org/2000/svg", className, fill: "none", viewBox: "0 0 24 24", stroke: "currentColor", strokeWidth: 1.5 }, React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" }));

        return React.createElement("section", { className: "bg-white/60 p-6 rounded-xl shadow-lg text-center" },
            React.createElement("h3", { className: "font-dancing-script text-4xl text-rose-400 mb-6 flex items-center justify-center gap-3" }, React.createElement(ListIcon, { className: "w-8 h-8" }), "Lista de Invitados"),
            loading && React.createElement("p", { className: "text-gray-600 font-light" }, "Cargando lista..."),
            error && React.createElement("p", { className: "text-red-500 font-light" }, error),
            !loading && !error && (
                guests.length > 0 ? (
                    React.createElement("ul", { className: "text-left space-y-2 max-h-80 overflow-y-auto pr-2 custom-scrollbar" },
                        guests.map((guest) => (
                            React.createElement("li", { key: guest.id, className: "p-3 bg-rose-50/70 rounded-lg shadow-sm flex items-center justify-between animate-fade-in-item" },
                                React.createElement("span", { className: "font-medium text-[#5D504A]" }, `${guest.first_name} ${guest.last_name}`),
                                React.createElement("div", { className: `w-5 h-5 rounded-sm shadow-inner flex-shrink-0 transition-colors duration-300 ${guest.has_confirmed ? 'bg-green-400' : 'bg-gray-300'}`, title: guest.has_confirmed ? "Asistencia Confirmada" : "Pendiente de Confirmaci√≥n" })
                            )
                        ))
                    )
                ) : (
                    React.createElement("p", { className: "text-gray-600 font-light" }, "A√∫n no hay invitados en la lista. ¬°A√±ade el primero!")
                )
            )
        );
    };
    
    // --- From components/RecommendedSongs.tsx ---
    const RecommendedSongs = () => {
        const [rawRecs, setRawRecs] = useState([]);
        const [recommendations, setRecommendations] = useState([]);
        const [loading, setLoading] = useState(true);
        const [error, setError] = useState(null);
        const [openDropdownKey, setOpenDropdownKey] = useState(null);

        const handleToggleDropdown = (key) => setOpenDropdownKey(prevKey => (prevKey === key ? null : key));
        
        const processAndSetRecommendations = useCallback((data) => {
            setRecommendations(processRecommendations(data));
        }, []);

        const fetchRecommendations = useCallback(async () => {
            setLoading(true);
            const { data, error } = await supabase.from('song_recommendations').select('guest_name, song_name');
            if (error) {
                setError("No se pudo cargar la lista de canciones.");
            } else if (data) {
                setRawRecs(data);
                processAndSetRecommendations(data);
            }
            setLoading(false);
        }, [processAndSetRecommendations]);

        useEffect(() => {
            fetchRecommendations();
            
            const channel = supabase.channel('song_recommendations_realtime')
                .on('postgres_changes', 
                    { event: '*', schema: 'public', table: 'song_recommendations' },
                    (payload) => {
                        fetchRecommendations();
                    }
                )
                .subscribe();

            // Listen for the global data reset event
            const handleDataReset = () => fetchRecommendations();
            window.addEventListener('data-reset', handleDataReset);

            return () => { 
                supabase.removeChannel(channel); 
                window.removeEventListener('data-reset', handleDataReset);
            };
        }, [fetchRecommendations, processAndSetRecommendations]);

        const ChevronDownIcon = ({ className }) => React.createElement("svg", { className, xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24", stroke: "currentColor" }, React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M19 9l-7 7-7-7" }));

        return React.createElement("section", { className: "bg-white/60 p-6 rounded-xl shadow-lg text-center" },
            React.createElement("h3", { className: "font-dancing-script text-4xl text-rose-400 mb-6" }, "Mi Lista Recomendada"),
            loading && React.createElement("p", { className: "text-gray-600 font-light" }, "Cargando canciones..."),
            error && React.createElement("p", { className: "text-red-500 font-light" }, error),
            !loading && !error && (
                recommendations.length > 0 ? (
                    React.createElement("ul", { className: "text-left space-y-3 max-h-80 overflow-y-auto pr-2" },
                        recommendations.map((rec, index) => (
                            React.createElement("li", { key: rec.key, className: "p-3 bg-rose-50/70 rounded-lg shadow-sm transition-all duration-300" },
                                React.createElement("div", { className: "flex items-center" },
                                    React.createElement("span", { className: "flex-shrink-0 font-bold text-amber-600 w-8 text-center text-lg" }, String(index + 1).padStart(2, '0')),
                                    React.createElement("div", { className: "ml-3 flex-1 min-w-0" },
                                        React.createElement("p", { className: "font-semibold text-[#5D504A] truncate", title: rec.song_name }, rec.song_name),
                                        rec.count > 1 ? (
                                            React.createElement("button", { onClick: () => handleToggleDropdown(rec.key), className: "text-sm text-gray-500 flex items-center cursor-pointer hover:text-rose-500 transition-colors focus:outline-none" }, `Sugerida por ${rec.count} invitados`, React.createElement(ChevronDownIcon, { className: `w-4 h-4 ml-1 transition-transform ${openDropdownKey === rec.key ? 'rotate-180' : ''}` }))
                                        ) : (
                                            React.createElement("p", { className: "text-sm text-gray-500 truncate" }, `Sugerida por ${rec.guests[0]}`)
                                        )
                                    )
                                ),
                                rec.count > 1 && React.createElement("div", { className: `transition-all duration-300 ease-in-out overflow-hidden ${openDropdownKey === rec.key ? 'max-h-96 mt-2' : 'max-h-0'}` },
                                    React.createElement("div", { className: "pl-11 pt-2 border-t border-rose-100/80" },
                                        React.createElement("ul", { className: "list-disc list-inside text-sm text-gray-600 space-y-1" },
                                            rec.guests.map((guest, idx) => React.createElement("li", { key: idx }, guest))
                                        )
                                    )
                                )
                            )
                        ))
                    )
                ) : (
                    React.createElement("p", { className: "text-gray-600 font-light" }, "A√∫n no hay canciones recomendadas.")
                )
            )
        );
    };

    // --- From components/Header.tsx ---
    const Header = ({ name }) => {
        const FlowerIcon = ({ className }) => React.createElement("svg", { className, xmlns: "http://www.w3.org/2000/svg", viewBox: "0 0 24 24", fill: "currentColor" }, React.createElement("path", { d: "M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zM12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zm0 8c-1.65 0-3-1.35-3-3s1.35-3 3-3 3 1.35 3 3-1.35 3-3 3z" }));
        return React.createElement("header", { className: "text-center py-8 border-b-2 border-dotted border-rose-200" },
            React.createElement("h2", { className: "font-satisfy text-5xl text-rose-400" }, "Mis 15 A√±os"),
            React.createElement("h1", { className: "font-dancing-script text-8xl text-amber-500 my-4", style: { textShadow: '2px 2px 4px rgba(0,0,0,0.1)' } }, name),
            React.createElement("div", { className: "flex justify-center items-center space-x-4 mt-4" },
                React.createElement("div", { className: "flex-grow h-px bg-rose-200" }),
                React.createElement(FlowerIcon, { className: "w-6 h-6 text-rose-300" }),
                React.createElement("div", { className: "flex-grow h-px bg-rose-200" })
            )
        );
    };

    // --- From components/AdminActions.tsx ---
    const AdminActions = () => {
        // State for deleting ALL data
        const [isDeleteAllModalOpen, setDeleteAllModalOpen] = useState(false);
        const [isDeleteAllLoading, setDeleteAllLoading] = useState(false);
        const [deleteAllError, setDeleteAllError] = useState(null);

        // State for deleting ONLY testers
        const [isDeleteTestersModalOpen, setDeleteTestersModalOpen] = useState(false);
        const [isDeleteTestersLoading, setDeleteTestersLoading] = useState(false);
        const [deleteTestersError, setDeleteTestersError] = useState(null);

        const handleDeleteAllData = async () => {
            setDeleteAllLoading(true);
            setDeleteAllError(null);
            
            const { error: rpcError } = await supabase.rpc('reset_all_data');

            if (rpcError) {
                console.error("Error deleting all data:", rpcError);
                setDeleteAllError(`No se pudo completar la acci√≥n. Error de base de datos: ${rpcError.message}`);
                setDeleteAllLoading(false);
            } else {
                window.dispatchEvent(new Event('data-reset'));
                setDeleteAllLoading(false);
                setDeleteAllModalOpen(false);
            }
        };

        const handleDeleteTesters = async () => {
            setDeleteTestersLoading(true);
            setDeleteTestersError(null);

            const { error: rpcError } = await supabase.rpc('reset_testers_data');
            
            if (rpcError) {
                console.error("Error deleting testers:", rpcError);
                setDeleteTestersError(`No se pudo completar la acci√≥n. Error de base de datos: ${rpcError.message}`);
                setDeleteTestersLoading(false);
            } else {
                // No need to dispatch event as testers list isn't displayed anywhere
                setDeleteTestersLoading(false);
                setDeleteTestersModalOpen(false);
            }
        };

        const TrashIcon = ({ className }) => React.createElement("svg", { xmlns: "http://www.w3.org/2000/svg", className, fill: "none", viewBox: "0 0 24 24", stroke: "currentColor", strokeWidth: 1.5 }, React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.134-2.036-2.134H8.716C7.58 2.34 6.67 3.294 6.67 4.474v.916m7.5 0a48.667 48.667 0 00-7.5 0" }));
        const UsersIcon = ({ className }) => React.createElement("svg", { xmlns: "http://www.w3.org/2000/svg", className, fill: "none", viewBox: "0 0 24 24", stroke: "currentColor", strokeWidth: 1.5 }, React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "M15 19.128a9.38 9.38 0 002.625.372 9.337 9.337 0 004.121-.952 4.125 4.125 0 00-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 018.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0111.964-4.663M12 12a4.5 4.5 0 014.5 4.5m-9 0a4.5 4.5 0 014.5-4.5M12 12a4.5 4.5 0 00-4.5 4.5m4.5-4.5v-2.25m0-2.16a2.25 2.25 0 00-1.883-2.185m1.883 2.185a2.25 2.25 0 01-2.185-1.883M3.864 11.135a2.25 2.25 0 01-2.185-1.883 2.25 2.25 0 011.883-2.185M12 12a4.5 4.5 0 00-4.5-4.5m4.5 4.5a4.5 4.5 0 01-4.5-4.5" }));

        return React.createElement(React.Fragment, null,
            React.createElement("section", { className: "bg-white/60 p-6 rounded-xl shadow-lg border border-red-200" },
                React.createElement("h3", { className: "font-dancing-script text-4xl text-red-500 mb-4" }, "Zona de Administraci√≥n"),
                React.createElement("div", {className: "space-y-4"},
                  React.createElement("div", null,
                    React.createElement("p", { className: "mb-2 font-light text-gray-700" }, "Esta acci√≥n borrar√° permanentemente los c√≥digos de los testers."),
                    React.createElement("button", {
                        onClick: () => setDeleteTestersModalOpen(true),
                        className: "w-full bg-blue-500 text-white font-medium px-6 py-3 rounded-full shadow-md hover:bg-blue-600 transition-colors duration-300 disabled:bg-blue-300 flex items-center justify-center mx-auto"
                    },
                        React.createElement(UsersIcon, { className: "w-5 h-5 mr-2" }),
                        "Borrar Testers"
                    )
                  ),
                  React.createElement("div", { className: "pt-4 border-t border-red-200" },
                    React.createElement("p", { className: "mb-2 font-light text-red-900/80" }, "¬°Cuidado! Esto borra todos los datos de invitados y canciones."),
                    React.createElement("button", {
                        onClick: () => setDeleteAllModalOpen(true),
                        className: "w-full bg-red-500 text-white font-medium px-6 py-3 rounded-full shadow-md hover:bg-red-600 transition-colors duration-300 disabled:bg-red-300 flex items-center justify-center mx-auto"
                    },
                        React.createElement(TrashIcon, { className: "w-5 h-5 mr-2" }),
                        "Borrar Todos los Datos"
                    )
                  )
                )
            ),
            // Modal for deleting testers
            isDeleteTestersModalOpen && React.createElement("div", { className: "fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 animate-fade-in", "aria-modal": "true", role: "dialog" },
                React.createElement("div", { className: "bg-white rounded-2xl shadow-xl p-8 max-w-md w-full animate-scale-up" },
                    React.createElement("h2", { className: "text-2xl font-bold text-gray-800" }, "Confirmar Acci√≥n"),
                    React.createElement("p", { className: "text-gray-600 mt-2 mb-6" }, "¬øEst√°s segura que quieres borrar todos los c√≥digos de tester? Esta acci√≥n no se puede deshacer."),
                    deleteTestersError && React.createElement("p", { className: "bg-red-100 text-red-700 p-3 rounded-lg text-sm mb-4" }, deleteTestersError),
                    React.createElement("div", { className: "flex justify-end gap-4" },
                        React.createElement("button", {
                            onClick: () => setDeleteTestersModalOpen(false),
                            disabled: isDeleteTestersLoading,
                            className: "px-6 py-2 rounded-full bg-gray-200 text-gray-800 hover:bg-gray-300 transition-colors disabled:opacity-50"
                        }, "Cancelar"),
                        React.createElement("button", {
                            onClick: handleDeleteTesters,
                            disabled: isDeleteTestersLoading,
                            className: "px-6 py-2 rounded-full bg-blue-500 text-white hover:bg-blue-600 transition-colors disabled:bg-blue-300 flex items-center"
                        },
                            isDeleteTestersLoading ? React.createElement(React.Fragment, null, React.createElement("svg", { className: "animate-spin -ml-1 mr-3 h-5 w-5 text-white", xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24" }, React.createElement("circle", { className: "opacity-25", cx: "12", cy: "12", r: "10", stroke: "currentColor", strokeWidth: "4" }), React.createElement("path", { className: "opacity-75", fill: "currentColor", d: "M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" })), "Borrando...") : "S√≠, Borrar Testers"
                        )
                    )
                )
            ),
            // Modal for deleting ALL data
            isDeleteAllModalOpen && React.createElement("div", { className: "fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 animate-fade-in", "aria-modal": "true", role: "dialog" },
                React.createElement("div", { className: "bg-white rounded-2xl shadow-xl p-8 max-w-md w-full animate-scale-up" },
                    React.createElement("h2", { className: "text-2xl font-bold text-gray-800" }, "Confirmar Acci√≥n"),
                    React.createElement("p", { className: "text-gray-600 mt-2 mb-6" }, "¬øEst√°s segura? Esta acci√≥n borrar√° TODOS los datos de forma PERMANENTE. No se puede deshacer."),
                    deleteAllError && React.createElement("p", { className: "bg-red-100 text-red-700 p-3 rounded-lg text-sm mb-4" }, deleteAllError),
                    React.createElement("div", { className: "flex justify-end gap-4" },
                        React.createElement("button", {
                            onClick: () => setDeleteAllModalOpen(false),
                            disabled: isDeleteAllLoading,
                            className: "px-6 py-2 rounded-full bg-gray-200 text-gray-800 hover:bg-gray-300 transition-colors disabled:opacity-50"
                        }, "Cancelar"),
                        React.createElement("button", {
                            onClick: handleDeleteAllData,
                            disabled: isDeleteAllLoading,
                            className: "px-6 py-2 rounded-full bg-red-500 text-white hover:bg-red-600 transition-colors disabled:bg-red-300 flex items-center"
                        },
                            isDeleteAllLoading ? React.createElement(React.Fragment, null, React.createElement("svg", { className: "animate-spin -ml-1 mr-3 h-5 w-5 text-white", xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24" }, React.createElement("circle", { className: "opacity-25", cx: "12", cy: "12", r: "10", stroke: "currentColor", strokeWidth: "4" }), React.createElement("path", { className: "opacity-75", fill: "currentColor", d: "M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" })), "Borrando...") : "S√≠, Borrar Todo"
                        )
                    )
                )
            )
        );
    };

    // --- From components/DownloadReport.tsx ---
    const DownloadReport = () => {
        const [isDownloading, setIsDownloading] = useState(false);
        const [downloadError, setDownloadError] = useState(null);

        const DownloadIcon = ({className}) => React.createElement("svg", { xmlns: "http://www.w3.org/2000/svg", className, fill: "none", viewBox: "0 0 24 24", stroke: "currentColor", strokeWidth: 1.5 }, React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3" }));
        
        const handleDownloadPDF = async () => {
            setIsDownloading(true);
            setDownloadError(null);
            try {
                const [guestsRes, songsRes] = await Promise.all([
                    supabase.from('confirmed_guests').select('first_name, last_name, has_confirmed').order('last_name', { ascending: true }),
                    supabase.from('song_recommendations').select('guest_name, song_name')
                ]);

                if (guestsRes.error || songsRes.error) {
                    console.error("DB Error:", guestsRes.error || songsRes.error);
                    throw new Error('No se pudieron obtener los datos.');
                }

                const guests = guestsRes.data;
                const songs = songsRes.data;
                
                const processedSongs = processRecommendations(songs);
                const guestBody = guests.map((guest, index) => [index + 1, `${guest.first_name} ${guest.last_name}`, guest.has_confirmed ? 'S√≠' : 'No']);
                const songBody = processedSongs.map((song, index) => [index + 1, song.song_name, song.count]);

                const doc = new jsPDF({ orientation: 'p', unit: 'mm', format: 'a4' });
                
                doc.setFont('Times-Roman', 'italic');
                doc.setFontSize(40);
                doc.setTextColor(245, 158, 11);
                doc.text(QUINCEANERA_NAME, doc.internal.pageSize.getWidth() / 2, 25, { align: 'center' });

                doc.setFontSize(18);
                doc.setFont('Helvetica', 'bold');
                doc.setTextColor(93, 80, 74);
                let startY = 40;
                doc.text("Lista de Invitados", 14, startY);

                autoTable(doc, {
                    head: [['Nro.', 'Nombre Completo', 'Confirmado']],
                    body: guestBody,
                    startY: startY + 5,
                    theme: 'grid',
                    headStyles: { fillColor: [221, 160, 172], textColor: 255 },
                    styles: { font: 'Helvetica', cellPadding: 2, fontSize: 10 },
                    columnStyles: {
                        0: { cellWidth: 15 },
                        1: { cellWidth: 'auto' },
                        2: { cellWidth: 25, halign: 'center' }
                    }
                });

                let finalY = doc.previousAutoTable.finalY;
                if (finalY > 230) {
                     doc.addPage();
                     finalY = 15;
                }

                doc.text("Canciones Recomendadas", 14, finalY + 15);
                autoTable(doc, {
                    head: [['Nro.', 'Canci√≥n', 'Votos']],
                    body: songBody,
                    startY: finalY + 20,
                    theme: 'grid',
                    headStyles: { fillColor: [221, 160, 172], textColor: 255 },
                    styles: { font: 'Helvetica', cellPadding: 2, fontSize: 10 },
                    columnStyles: {
                        0: { cellWidth: 15 },
                        1: { cellWidth: 'auto' },
                        2: { cellWidth: 20, halign: 'center' }
                    }
                });
                
                // --- Add Footer to all pages ---
                const pageCount = doc.internal.getNumberOfPages();
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                
                doc.setFont('Helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(150);

                const footerLine1 = "Keila Portillo - Pergamino - Buenos Aires";
                const footerLine2 = "@keiiportillo_fotografia - 2477238364";

                for(let i = 1; i <= pageCount; i++) {
                    doc.setPage(i);
                    doc.text(footerLine1, pageWidth / 2, pageHeight - 15, { align: 'center' });
                    doc.text(footerLine2, pageWidth / 2, pageHeight - 10, { align: 'center' });
                }
                // --- End Footer ---

                doc.save(`Lista_Invitados_${QUINCEANERA_NAME}.pdf`);

            } catch (error) {
                console.error("PDF Generation failed:", error);
                setDownloadError(error.message || 'No se pudo generar el PDF.');
                setTimeout(() => setDownloadError(null), 5000);
            } finally {
                setIsDownloading(false);
            }
        };

        return React.createElement("section", { className: "bg-white/60 p-6 rounded-xl shadow-lg text-center" },
            React.createElement("h3", { className: "font-dancing-script text-4xl text-emerald-500 mb-4" }, "Reporte de Invitados"),
            React.createElement("p", { className: "mb-6 font-light" }, "Descarga un PDF con la lista de invitados y las canciones m√°s populares."),
            React.createElement("button", { 
                onClick: handleDownloadPDF,
                className: "w-full bg-emerald-500 text-white font-medium px-8 py-3 rounded-full shadow-md hover:bg-emerald-600 transition-colors duration-300 disabled:bg-emerald-300 disabled:cursor-not-allowed flex items-center justify-center",
                disabled: isDownloading
            },
                isDownloading ? React.createElement(React.Fragment, null, React.createElement("svg", { className: "animate-spin -ml-1 mr-3 h-5 w-5 text-white", xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24" }, React.createElement("circle", { className: "opacity-25", cx: "12", cy: "12", r: "10", stroke: "currentColor", strokeWidth: "4" }), React.createElement("path", { className: "opacity-75", fill: "currentColor", d: "M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" })), "Generando PDF...") : React.createElement("span", {className: "flex items-center justify-center"}, React.createElement(DownloadIcon, {className: "h-5 w-5 mr-2"}), "Descargar Lista de invitados")
            ),
            downloadError && React.createElement("p", { className: "text-red-500 mt-4" }, downloadError)
        );
    };

    // --- From components/TesterCreator.tsx ---
    const TesterCreator = () => {
        const [testerCode, setTesterCode] = useState('');
        const [isLoading, setIsLoading] = useState(false);
        const [error, setError] = useState(null);
        const [successMessage, setSuccessMessage] = useState('');

        const handleChange = (e) => {
            const val = e.target.value.replace(/[^0-9]/g, '');
            if (val.length <= 8) {
                setTesterCode(val);
            }
            if(error) setError(null);
            if(successMessage) setSuccessMessage('');
        };
        
        const handleSubmit = async (e) => {
            e.preventDefault();
            if (testerCode.length !== 8) {
                setError("El c√≥digo debe ser exactamente de 8 d√≠gitos.");
                return;
            }
            setIsLoading(true);
            setError(null);
            setSuccessMessage('');
            
            try {
                const { error: insertError } = await supabase
                    .from('testers')
                    .insert([{ tester_code: testerCode }]);
                
                if (insertError) {
                    if (insertError.code === '23505') {
                        setError(`El c√≥digo "${testerCode}" ya existe. Elige otro.`);
                    } else {
                        setError("Error al crear el tester. Revisa el SQL y los permisos.");
                    }
                } else {
                    setSuccessMessage(`¬°Tester con c√≥digo "${testerCode}" creado con √©xito!`);
                    setTesterCode('');
                }
            } catch (err) {
                 setError("Ocurri√≥ un error inesperado.");
            } finally {
                setIsLoading(false);
            }
        };

        const KeyIcon = ({className}) => React.createElement("svg", { xmlns: "http://www.w3.org/2000/svg", className, fill: "none", viewBox: "0 0 24 24", stroke: "currentColor", strokeWidth: 1.5 }, React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "M15.75 5.25a3 3 0 013 3m3 0a6 6 0 01-7.029 5.912c-.563-.097-1.159.026-1.563.43L10.5 17.25H8.25v2.25H6v2.25H2.25v-2.818c0-.597.237-1.17.659-1.591l6.499-6.499c.404-.404.527-1 .43-1.563A6 6 0 1121.75 8.25z" }));

        return React.createElement("section", { className: "bg-white/60 p-6 rounded-xl shadow-lg text-center" },
            React.createElement("h3", { className: "font-dancing-script text-4xl text-sky-500 mb-2" }, "Crear Tester"),
            React.createElement("p", { className: "mb-6 font-light" }, "Crea c√≥digos de 8 d√≠gitos para los testers."),
             React.createElement("form", { onSubmit: handleSubmit, className: "flex flex-col gap-4 items-center justify-center w-full max-w-sm mx-auto" },
                React.createElement("input", { 
                    type: "text", 
                    value: testerCode,
                    onChange: handleChange, 
                    placeholder: "N√∫mero de 8 d√≠gitos",
                    className: "w-full px-4 py-3 rounded-full border border-sky-200 focus:outline-none focus:ring-2 focus:ring-sky-300 transition text-center tracking-widest font-mono", 
                    disabled: isLoading, 
                    "aria-label": "C√≥digo de tester", 
                    inputMode: "numeric",
                    pattern: "\\d{8}",
                    maxLength: 8
                }),
                React.createElement("button", { type: "submit", className: "w-full bg-sky-500 text-white font-medium px-8 py-3 rounded-full shadow-md hover:bg-sky-600 transition-colors duration-300 disabled:bg-sky-300 disabled:cursor-not-allowed flex items-center justify-center", disabled: isLoading || testerCode.length !== 8 },
                    isLoading ? React.createElement(React.Fragment, null, React.createElement("svg", { className: "animate-spin -ml-1 mr-3 h-5 w-5 text-white", xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24" }, React.createElement("circle", { className: "opacity-25", cx: "12", cy: "12", r: "10", stroke: "currentColor", strokeWidth: "4" }), React.createElement("path", { className: "opacity-75", fill: "currentColor", d: "M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" })), "Creando...") : React.createElement("span", {className: "flex items-center"}, React.createElement(KeyIcon, {className: "h-5 w-5 mr-2"}), "Crear Tester")
                )
            ),
            error && React.createElement("p", { className: "text-red-500 mt-4" }, error),
            successMessage && React.createElement("p", { className: "text-green-600 mt-4 animate-fade-in" }, successMessage)
        );
    };

    // --- From components/Dashboard.tsx ---
    const Dashboard = () => {
        const { user, logout } = useAuth();
        return React.createElement("div", { className: "bg-[#FDF6F0] min-h-screen text-[#5D504A] antialiased py-4 pb-12" },
            React.createElement("div", { className: "fixed inset-0 bg-no-repeat bg-cover bg-top md:bg-contain md:bg-center opacity-40", style: { backgroundImage: "url('https://img.freepik.com/foto-gratis/chica-sonriente-tiro-medio-hermoso-vestido_52683-86468.jpg')" } }),
            React.createElement("div", { className: "fixed top-4 right-4 z-20" },
                React.createElement("button", { onClick: logout, className: "bg-rose-400/80 backdrop-blur-sm text-white text-sm font-semibold px-4 py-2 rounded-full shadow-lg hover:bg-rose-500 transition-colors duration-300", "aria-label": "Cerrar Sesi√≥n" }, "Cerrar Sesi√≥n")
            ),
            React.createElement("div", { className: "relative z-10 max-w-md mx-auto p-6 space-y-8" },
                React.createElement(Header, { name: QUINCEANERA_NAME }),
                React.createElement(GuestConfirmation, null),
                React.createElement(ConfirmedGuestsList, null),
                React.createElement(RecommendedSongs, null),
                React.createElement(DownloadReport, null),
                user.role === 'admin' && React.createElement(React.Fragment, null, 
                  React.createElement(TesterCreator, null),
                  React.createElement(AdminActions, null)
                )
            )
        );
    };

    // --- From components/LoginPage.tsx ---
    const LoginPage = () => {
        const [mode, setMode] = useState('admin'); // 'admin' or 'tester'
        
        const [username, setUsername] = useState('');
        const [password, setPassword] = useState('');
        const [testerCode, setTesterCode] = useState('');
        
        const [error, setError] = useState(null);
        const [isLoading, setIsLoading] = useState(false);
        const auth = useAuth();

        const handleAdminSubmit = (e) => {
            e.preventDefault();
            setError(null);
            if (!username || !password) {
                setError('Por favor, completa todos los campos.');
                return;
            }
            setIsLoading(true);
            setTimeout(() => {
                const success = auth.login(username, password);
                if (!success) {
                    setError('Usuario o contrase√±a incorrectos.');
                    setIsLoading(false);
                }
            }, 500);
        };

        const handleTesterSubmit = async (e) => {
            e.preventDefault();
            setError(null);
            if (!/^\d{8}$/.test(testerCode)) {
                setError('El c√≥digo de tester debe ser un n√∫mero de 8 d√≠gitos.');
                return;
            }
            setIsLoading(true);
            const success = await auth.loginAsTester(testerCode);
            if (!success) {
                setError('C√≥digo de tester inv√°lido o no encontrado.');
                setIsLoading(false);
            }
        };
        
        const TabButton = ({ isActive, onClick, children, activeColorClass }) => React.createElement("button", {
            type: "button",
            onClick: onClick,
            className: `w-1/2 py-2.5 text-sm font-medium leading-5 text-center transition-colors duration-200 focus:outline-none rounded-lg ${isActive ? `bg-white ${activeColorClass} shadow-md` : 'text-gray-600 hover:bg-white/50'}`
        }, children);

        return React.createElement("div", { className: "bg-[#FDF6F0] min-h-screen text-[#5D504A] flex items-center justify-center p-4 antialiased" },
            React.createElement("div", { className: "fixed inset-0 bg-no-repeat bg-cover bg-center opacity-40", style: { backgroundImage: "url('https://img.freepik.com/foto-gratis/chica-sonriente-tiro-medio-hermoso-vestido_52683-86468.jpg')" } }),
            React.createElement("main", { className: "relative z-10 max-w-sm w-full bg-white/70 backdrop-blur-sm p-8 rounded-2xl shadow-xl space-y-6 text-center" },
                React.createElement("div", null,
                    React.createElement("h1", { className: "font-satisfy text-4xl text-rose-400" }, "Panel de Control"),
                    React.createElement("p", { className: "font-dancing-script text-6xl text-amber-500", style: { textShadow: '2px 2px 4px rgba(0,0,0,0.1)' } }, QUINCEANERA_NAME)
                ),
                React.createElement("div", { className: `w-full ${mode === 'admin' ? 'bg-rose-100/50' : 'bg-sky-100/50'} rounded-lg p-1 flex space-x-1 transition-colors` },
                  React.createElement(TabButton, { isActive: mode === 'admin', onClick: () => setMode('admin'), activeColorClass: 'text-rose-500' }, "Administrador"),
                  React.createElement(TabButton, { isActive: mode === 'tester', onClick: () => setMode('tester'), activeColorClass: 'text-sky-500' }, "Tester")
                ),
                mode === 'admin' ? (
                    React.createElement("form", { onSubmit: handleAdminSubmit, className: "space-y-4 animate-fade-in" },
                        React.createElement("input", { type: "text", value: username, onChange: (e) => setUsername(e.target.value), placeholder: "Usuario", className: "w-full px-4 py-3 rounded-full border border-rose-200 focus:outline-none focus:ring-2 focus:ring-rose-300 transition", disabled: isLoading, "aria-label": "Usuario", autoComplete: "username" }),
                        React.createElement("input", { type: "password", value: password, onChange: (e) => setPassword(e.target.value), placeholder: "Contrase√±a", className: "w-full px-4 py-3 rounded-full border border-rose-200 focus:outline-none focus:ring-2 focus:ring-rose-300 transition", disabled: isLoading, "aria-label": "Contrase√±a", autoComplete: "current-password" }),
                        React.createElement("button", { type: "submit", className: "w-full bg-rose-400 text-white font-medium px-8 py-3 rounded-full shadow-md hover:bg-rose-500 transition-colors duration-300 disabled:bg-rose-300 disabled:cursor-not-allowed flex items-center justify-center", disabled: isLoading },
                            isLoading ? React.createElement(React.Fragment, null, React.createElement("svg", { className: "animate-spin -ml-1 mr-3 h-5 w-5 text-white", xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24" }, React.createElement("circle", { className: "opacity-25", cx: "12", cy: "12", r: "10", stroke: "currentColor", strokeWidth: "4" }), React.createElement("path", { className: "opacity-75", fill: "currentColor", d: "M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" })), "Ingresando...") : "Ingresar"
                        )
                    )
                ) : (
                    React.createElement("form", { onSubmit: handleTesterSubmit, className: "space-y-4 animate-fade-in" },
                        React.createElement("input", { type: "text", value: testerCode, onChange: (e) => setTesterCode(e.target.value.replace(/[^0-9]/g, '')), placeholder: "N√∫mero de tester", className: "w-full px-4 py-3 rounded-full border border-sky-200 focus:outline-none focus:ring-2 focus:ring-sky-300 transition", disabled: isLoading, "aria-label": "N√∫mero de tester", inputMode: "numeric", maxLength: 8 }),
                        React.createElement("button", { type: "submit", className: "w-full bg-sky-500 text-white font-medium px-8 py-3 rounded-full shadow-md hover:bg-sky-600 transition-colors duration-300 disabled:bg-sky-300 disabled:cursor-not-allowed flex items-center justify-center", disabled: isLoading },
                            isLoading ? React.createElement(React.Fragment, null, React.createElement("svg", { className: "animate-spin -ml-1 mr-3 h-5 w-5 text-white", xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24" }, React.createElement("circle", { className: "opacity-25", cx: "12", cy: "12", r: "10", stroke: "currentColor", strokeWidth: "4" }), React.createElement("path", { className: "opacity-75", fill: "currentColor", d: "M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" })), "Verificando...") : "Ingresar"
                        )
                    )
                ),
                error && React.createElement("p", { className: "text-red-500 pt-2 text-sm" }, error)
            )
        );
    };

    // --- App Component (from App.tsx) ---
    const App = () => {
      const { isAuthenticated } = useAuth();
      return isAuthenticated ? React.createElement(Dashboard, null) : React.createElement(LoginPage, null);
    };

    // --- Entry Point (from index.tsx) ---
    const rootElement = document.getElementById('root');
    if (!rootElement) {
      throw new Error("Could not find root element to mount to");
    }
    const root = ReactDOM.createRoot(rootElement);
    root.render(
      React.createElement(React.StrictMode, null,
        React.createElement(AuthProvider, null,
          React.createElement(App, null)
        )
      )
    );
  </script>
</body>
</html>
